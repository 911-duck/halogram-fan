#define NUM_LEDS 30
#define BRIGHTNESS 100
#define MOTOR_MAX 160
#define RES 2
#define COEF 0.3
#define PODGON 1.3
#define OFFSET 0
#define NUM_FRAMES 1
#define FRAME_RATE 1

#define PIN 4

#include <TimerOne.h>
#include "Adafruit_NeoPixel.h"
#include "gamma.h"

const uint16_t frame0[][15] PROGMEM = {
  { 0xAEDE, 0x763D, 0x64F6, 0x2265, 0x11C3, 0x438A, 0x1A24, 0x32A7, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xBF1E, 0x763D, 0x6538, 0x2225, 0x1A44, 0x4389, 0x0901, 0x1163, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xBF1E, 0x761D, 0x6538, 0x2205, 0x1A65, 0x2245, 0x2A25, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xBF1E, 0x8E7D, 0x6538, 0x21E4, 0x22C5, 0x22C6, 0x4BEA, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xBF1E, 0x865D, 0x6518, 0x2205, 0x33A8, 0x2B26, 0x43A9, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xAEDD, 0x865D, 0x54B6, 0x2A46, 0x442A, 0x33C8, 0x3B48, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xAEDD, 0x7E3D, 0x4C74, 0x43C9, 0x4C2A, 0x4429, 0x4C8A, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xAEDD, 0x7E3D, 0x4C74, 0x43E9, 0x0922, 0x4CAA, 0x2B47, 0x1163, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xAEDD, 0x65BD, 0x5495, 0x4429, 0x0060, 0x3387, 0x1962, 0x2A66, 0x0040, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xA6BD, 0x65BD, 0x3BEE, 0x4CEB, 0x0040, 0x00C0, 0xCE08, 0x2A66, 0x1983, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xA6BD, 0x659C, 0x3BAB, 0x550B, 0x0020, 0x08E2, 0xF74A, 0x2266, 0x1103, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xA6BD, 0x659C, 0x33AD, 0x550B, 0x0040, 0x3183, 0xFFCB, 0xCE2C, 0x0020, 0x0020, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xA6BD, 0x4D3C, 0x33AD, 0x4C8A, 0x0020, 0xACE6, 0xFFCE, 0xFFB0, 0x3307, 0x2245, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x9E7D, 0x4D3C, 0x444A, 0x4C69, 0x2A46, 0xBD67, 0xFFF7, 0xFFCF, 0x2B07, 0x3328, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x9E7D, 0x44FB, 0x444A, 0x3BC8, 0x19E4, 0xF6C8, 0xFFD8, 0xFF8A, 0x4C0A, 0x4266, 0x11A3, 0x10E2, 0x0000, 0x0000, 0x0000 }, 
  { 0x9E7D, 0x44FB, 0x444A, 0x3BA8, 0x2A65, 0xD607, 0xFFD5, 0xFF28, 0x21E4, 0x08C1, 0x11A3, 0x43C9, 0x0000, 0x0000, 0x0000 }, 
  { 0x967D, 0x44DA, 0x552A, 0x4CCA, 0x4C0A, 0xAD06, 0xFFAC, 0xEEA7, 0x0881, 0x11A3, 0x1A45, 0x548B, 0x0000, 0x0000, 0x0000 }, 
  { 0x7DFD, 0x44DA, 0x552B, 0x552B, 0x3307, 0x73C6, 0xFF6A, 0xDDC5, 0x08E1, 0x1A24, 0x3347, 0x0861, 0x0000, 0x0000, 0x0000 }, 
  { 0x7DFD, 0x4499, 0x550A, 0x554B, 0x0962, 0x2A65, 0xF707, 0x83A3, 0x0962, 0x2A66, 0x4369, 0x1983, 0x2A86, 0x0000, 0x0000 }, 
  { 0x7DFD, 0x4499, 0x5D6B, 0x5D8C, 0x11A3, 0x21C6, 0xDE06, 0x0081, 0x0901, 0x2265, 0x3B88, 0x2265, 0x2AA6, 0x0020, 0x0861 }, 
  { 0x7DFD, 0x4499, 0x5D2C, 0x6E0D, 0x1162, 0x21E4, 0x32C5, 0x4C4A, 0x0982, 0x3B68, 0x00A1, 0x1142, 0x0902, 0x08A1, 0x2AC6 }, 
  { 0x7DFD, 0x3C16, 0x5D2C, 0x7E8F, 0x11A3, 0x2AC6, 0x4429, 0x32C6, 0x1A04, 0x0020, 0x0902, 0x0902, 0x2A66, 0x2285, 0x2B26 }, 
  { 0x75DD, 0x3C16, 0x43E8, 0x7E8F, 0x11E3, 0x2B06, 0x3307, 0x08C1, 0x1102, 0x4389, 0x43C9, 0x1122, 0x1A24, 0x2285, 0x3347 }, 
  { 0x75DD, 0x3BB4, 0x43E8, 0x7E6F, 0x1A24, 0x3367, 0x3BA8, 0x2245, 0x0982, 0x22A5, 0x3367, 0x08E1, 0x1183, 0x3327, 0x1163 }, 
  { 0x75DD, 0x3BB4, 0x5CEB, 0x54AA, 0x22A5, 0x3B87, 0x4409, 0x4449, 0x3BA8, 0x2B06, 0x0922, 0x00E1, 0x19E4, 0x2A66, 0x0000 }, 
  { 0x75DD, 0x3BB4, 0x75AE, 0x2AA5, 0x22C6, 0x3BE8, 0x4449, 0x4C8A, 0x552B, 0xDAEC, 0x836A, 0x08E1, 0x32E7, 0x2A86, 0x08A1 }, 
  { 0x75DD, 0x1162, 0x6D4D, 0x0942, 0x3347, 0x4429, 0x4C8A, 0x54EB, 0x3BE8, 0xFA4C, 0xFB2F, 0x08E1, 0x3307, 0x3327, 0x43C9 }, 
  { 0x43ED, 0x1162, 0x8690, 0x0921, 0x3347, 0x4C69, 0x4CAA, 0x5D6C, 0x646A, 0xFAAE, 0xF9CA, 0x1A04, 0x3307, 0x3BA8, 0x1A44 }, 
  { 0x3388, 0x0040, 0x5CEA, 0x11C3, 0x33A7, 0x4C8A, 0x552B, 0x760F, 0x7DAB, 0xFC12, 0xF9CA, 0x2265, 0x2AE6, 0x32A6, 0x6D0D }, 
  { 0x3388, 0x00A0, 0x5CEA, 0x11E3, 0x33C8, 0x5D2C, 0x6DEE, 0x4429, 0x3C28, 0xFD15, 0xF9CA, 0x2244, 0x6CEE, 0x6D2D, 0x5D2B }, 
  { 0x3388, 0x0060, 0x1A23, 0x22A5, 0x3BA8, 0x654D, 0x75EF, 0x2B66, 0x3BE8, 0xFC73, 0xF989, 0x542B, 0x652C, 0x656C, 0x5D6B }, 
  { 0x3387, 0x0060, 0x00E0, 0x1A85, 0x3306, 0x5D0C, 0x2285, 0x3387, 0x33A7, 0xF3B0, 0xF989, 0x3BA7, 0x654C, 0x6DAD, 0x3346 }, 
  { 0x3387, 0x0060, 0x00E0, 0x1285, 0x2285, 0x1183, 0x1A44, 0x33C7, 0x3C08, 0x3BE7, 0x01C2, 0x4449, 0x75AD, 0x43E8, 0x0020 }, 
  { 0x3387, 0x0060, 0x5AC6, 0x5367, 0x3BA7, 0x1182, 0x22A5, 0x3BE8, 0x3C28, 0x54CA, 0x22C5, 0x5D0B, 0x43E8, 0x08A1, 0x0000 }, 
  { 0x3387, 0x0040, 0x946A, 0x8C8A, 0x4469, 0x4C49, 0x22C5, 0x4449, 0x3BA7, 0x0941, 0x3367, 0x75CD, 0x654C, 0x6DAC, 0x19E4 }, 
  { 0x2BA6, 0x0040, 0xDE90, 0xEEB0, 0x4449, 0x6DEE, 0x22E5, 0x22A5, 0x00A0, 0x11C3, 0x54CB, 0x75ED, 0x6DCC, 0x75ED, 0x08A1 }, 
  { 0x3C27, 0x1A43, 0xFF73, 0xEEF2, 0x54EA, 0x75EE, 0x1A64, 0x548A, 0x3C28, 0x2265, 0x6DAD, 0x6DED, 0x75ED, 0x3346, 0x0000 }, 
  { 0x3C27, 0x1A43, 0xFF73, 0xF733, 0x32E6, 0x32C6, 0x33A7, 0x4CEA, 0x5D2B, 0x3B88, 0x760E, 0x7E0E, 0x43E8, 0x0000, 0x0000 }, 
  { 0x3C27, 0x3BA6, 0xFF73, 0xF711, 0x2224, 0x00A0, 0x66EE, 0x5ECC, 0x19E3, 0x1A24, 0x3BE7, 0x0060, 0x0000, 0x0000, 0x0000 }, 
  { 0x54EA, 0x3BA6, 0xFF53, 0xF732, 0x4BE7, 0x00E1, 0x8FD3, 0x672D, 0x0922, 0x2B06, 0x552B, 0x4CAA, 0x0000, 0x0000, 0x0000 }, 
  { 0x54EA, 0x6DEC, 0xFF73, 0xF753, 0x64E9, 0x0962, 0x8FD3, 0x676F, 0x0901, 0x3346, 0x656C, 0x2AA5, 0x2080, 0x20A0, 0x28A0 }, 
  { 0x54EA, 0x3365, 0xFF73, 0xF754, 0x6CA8, 0x7C29, 0x8FD3, 0x6F90, 0x11A2, 0x4C49, 0x4CAA, 0x0000, 0x1880, 0x20A0, 0x3902 }, 
  { 0x54EA, 0x5488, 0xFF73, 0xFF75, 0x6CA8, 0x4B67, 0xD7FB, 0x7FB1, 0x2203, 0x4CAA, 0x5D0B, 0x22A4, 0x1040, 0x20A0, 0x3921 }, 
  { 0x550B, 0x5488, 0xFF73, 0xFF76, 0x6BC7, 0x22C4, 0xDFFB, 0x7790, 0x19E4, 0x4CAA, 0x5D2C, 0x652C, 0x1860, 0x20A0, 0x4962 }, 
  { 0x550B, 0x4C27, 0xFF73, 0xFF76, 0x6367, 0x2305, 0xAFD6, 0x7790, 0x1102, 0x5CEB, 0x75CE, 0x75AE, 0x1880, 0x28C1, 0x59C3 }, 
  { 0x550B, 0x2A64, 0xFF74, 0xFF76, 0x5AE6, 0x2B46, 0x6F2F, 0x7770, 0x0921, 0x5CEB, 0x8E70, 0x862F, 0x28C1, 0x4962, 0x7224 }, 
  { 0x552B, 0x2A64, 0xFF74, 0xFF75, 0x42A5, 0x2B46, 0x5DED, 0x7EEF, 0x0921, 0x54AA, 0x4408, 0x0000, 0x1880, 0x4982, 0x61E3 }, 
  { 0x552B, 0x08A0, 0xFF74, 0xFF75, 0x3366, 0x2AE5, 0x2325, 0x658C, 0x0962, 0x54AA, 0x7E0E, 0x0000, 0x30E1, 0x51A3, 0x7224 }, 
  { 0x552B, 0x29E4, 0xFF74, 0xFF75, 0x4CC8, 0x0962, 0x2AE5, 0x4D2A, 0x1A04, 0x4449, 0x7E2E, 0x1142, 0x4982, 0x51A3, 0x20A1 }, 
  { 0x552B, 0x1101, 0xFFD5, 0xFF76, 0x5E0B, 0x0962, 0x33A7, 0x558B, 0x3326, 0x5D2B, 0x7E6F, 0x3326, 0x0000, 0x0000, 0x0000 }, 
  { 0x554B, 0x1101, 0xE734, 0xFF96, 0x5DEB, 0x3326, 0x3387, 0x2AE6, 0x11A3, 0x4429, 0x650C, 0x2A85, 0x0000, 0x0000, 0x0000 }, 
  { 0x554B, 0x3BA8, 0xDEB3, 0xC672, 0x5DEB, 0x654C, 0x3346, 0x08A1, 0x11C2, 0x658C, 0x656B, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x554B, 0x3BA8, 0xDEB3, 0x850C, 0x5DAB, 0x6DED, 0x2B06, 0x3BE7, 0x09A2, 0x65CC, 0x7E2E, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x44A9, 0x5D6C, 0x1942, 0x2345, 0x5D8B, 0x6DED, 0x2284, 0x4CA9, 0x0962, 0x4CEA, 0x6E0D, 0x1142, 0x0000, 0x0000, 0x0000 }, 
  { 0x44A9, 0x5D6C, 0x2A24, 0x1AE4, 0x5D8B, 0x65CC, 0x550B, 0x550A, 0x1162, 0x4448, 0x65EC, 0x862E, 0x0000, 0x0000, 0x0000 }, 
  { 0x44A9, 0x764E, 0x3B26, 0x3386, 0x5D8B, 0x764E, 0x65AC, 0x4CEA, 0x11C3, 0x338C, 0x65CD, 0x7E4E, 0x1983, 0x0000, 0x0000 }, 
  { 0x44A9, 0x764E, 0x7E6F, 0x4428, 0x658B, 0x764E, 0x768E, 0x44C9, 0x11A2, 0x44B9, 0x3C56, 0x7E4E, 0x8E4F, 0x0000, 0x0000 }, 
  { 0x44A9, 0x6E2E, 0x7E6F, 0x4C69, 0x65AB, 0x6DEC, 0x22A5, 0x4468, 0x0921, 0x657C, 0x447A, 0x8E8F, 0x8E90, 0x0040, 0x0000 }, 
  { 0x44A9, 0x6E2E, 0x7E90, 0x5D0C, 0x65AC, 0x65CC, 0x4CC9, 0x2B05, 0x0901, 0x9E9E, 0x44BB, 0x758D, 0x8E90, 0x0020, 0x0000 }, 
  { 0x44A9, 0x6E2E, 0x766F, 0x652C, 0x6DAD, 0x65AC, 0x65CC, 0x3386, 0x1165, 0xAEDE, 0x659C, 0x5D2B, 0x9F32, 0x0000, 0x0000 }, 
  { 0x44A9, 0x6E4E, 0x766F, 0x6D4D, 0x6DCD, 0x65AC, 0x762E, 0x2B25, 0x3A03, 0x6DDD, 0x8E3E, 0x6DAD, 0x1122, 0x0000, 0x0000 }, 
  { 0x3BE7, 0x766E, 0x7E8F, 0x548A, 0x75CE, 0x65CC, 0x6E0D, 0x3386, 0x4D0A, 0x4436, 0x85D4, 0x658C, 0x3326, 0x0000, 0x0000 }, 
  { 0x33C7, 0x766E, 0x7E6F, 0x4C2A, 0x75EE, 0x65EC, 0x6E0D, 0x65CD, 0x556B, 0x3386, 0x3BC7, 0x7E2F, 0x4C89, 0x1122, 0x0000 }, 
  { 0x33C7, 0x552B, 0x6D8D, 0x546A, 0x75CE, 0x6E2D, 0x762D, 0x7EAF, 0x556B, 0x5DAB, 0x1A23, 0x552A, 0x7DED, 0x652B, 0x0000 }, 
  { 0x33C7, 0x552B, 0x4BE9, 0x43A8, 0x75CE, 0x764E, 0x764E, 0x768E, 0x5DAB, 0x5DCB, 0x19E3, 0x554B, 0x3BE7, 0x8650, 0x0000 }, 
  { 0x33C7, 0x552B, 0x2B05, 0x19C3, 0x75AE, 0x766E, 0x7EAF, 0x6E6E, 0x5DCC, 0x65CC, 0x4448, 0x5D2B, 0x7E0E, 0x5D4B, 0x3BE8 }, 
  { 0x33C7, 0x552B, 0x2B05, 0x11C2, 0x6D4C, 0x760E, 0x550B, 0x86F0, 0x5D8C, 0x5DCC, 0x7ECF, 0x2B06, 0xAF94, 0x866F, 0x7E0E }, 
  { 0x2B46, 0x552B, 0x4CAA, 0x11C2, 0x654C, 0x75CE, 0x3BE7, 0x4CEA, 0x33C7, 0x5D8B, 0x8F31, 0x43C9, 0x3CC7, 0x96F1, 0x9F11 }, 
  { 0x2B46, 0x556B, 0x4CAA, 0x2B26, 0x5D2B, 0x5D0B, 0x754E, 0x54AA, 0x65AD, 0x3C08, 0x3C07, 0x19A3, 0x6E0D, 0x65CC, 0x1902 }, 
  { 0x2B46, 0x556B, 0x764F, 0x7E2F, 0x4C29, 0x4C69, 0x43A8, 0x0000, 0x654C, 0xA4EA, 0xB54B, 0x5D6B, 0x10A2, 0x8690, 0x0000 }, 
  { 0x2B46, 0x556B, 0x6E0D, 0x8690, 0x3B87, 0x3326, 0x3366, 0x0901, 0x0000, 0xDE4E, 0xDE4F, 0x766F, 0x0000, 0x1963, 0x0000 }, 
  { 0x2B46, 0x554B, 0x6DED, 0x760E, 0x54EA, 0x3BC7, 0x3366, 0x3326, 0x0000, 0xEF34, 0xEEF1, 0x4266, 0x0000, 0x0000, 0x0000 }, 
  { 0x2B46, 0x554B, 0x65CC, 0x65ED, 0x552B, 0x7ECF, 0x4CAA, 0x4408, 0x0020, 0xF754, 0xFFB9, 0x31A4, 0x0000, 0x0000, 0x0000 }, 
  { 0x2B46, 0x552A, 0x65CC, 0x6E0D, 0x65AD, 0x9732, 0xB7F5, 0x9F73, 0x0020, 0xEED0, 0xFF97, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x2B46, 0x554B, 0x65CC, 0x6E0D, 0x5D2B, 0x766E, 0x65AC, 0x54EA, 0x22C4, 0xE6B0, 0xFFB9, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x2B46, 0x4D0A, 0x65CC, 0x6E2E, 0x5D4B, 0x7E8F, 0x768E, 0x6E6E, 0x65AC, 0xC5D0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x2325, 0x4D0A, 0x65CC, 0x764F, 0x65AC, 0x9732, 0xA734, 0x9712, 0x7E8F, 0x4429, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x2325, 0x44C9, 0x65CC, 0x5D2C, 0x5D2B, 0x5C0B, 0x3AE7, 0x3286, 0x9672, 0x8630, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x2325, 0x44C9, 0x658C, 0x2AC5, 0x3346, 0x0020, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x2325, 0x44C9, 0x5D2B, 0x43E8, 0x764F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x2305, 0x44C9, 0x4C89, 0x6DCD, 0x3B07, 0x0020, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x2305, 0x3C88, 0x4CCA, 0x65ED, 0x0922, 0x0040, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x2305, 0x3C88, 0x4CCA, 0x6DED, 0x1AA4, 0x3BA7, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x2305, 0x3C48, 0x4CCA, 0x2B25, 0x3366, 0x7E90, 0x1142, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x1A64, 0x3C48, 0x3C27, 0x1A43, 0x552B, 0x9692, 0x3366, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x1A64, 0x3C48, 0x33E7, 0x2325, 0x554A, 0x43A8, 0x33A7, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x1A64, 0x3C27, 0x33C7, 0x2B66, 0x5D8C, 0x2365, 0x75AE, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x1A64, 0x2B26, 0x33C7, 0x33A6, 0x5D4B, 0x660D, 0x3A87, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x2B26, 0x2B26, 0x2B66, 0x2B65, 0x5D8B, 0x6E6F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x2B26, 0x22A4, 0x1A84, 0x2325, 0x65AC, 0xD42F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x2B26, 0x1A03, 0x11A2, 0x22C4, 0x65EC, 0xFC32, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x3BE8, 0x1A03, 0x22C5, 0x2B05, 0x5CC9, 0xFC72, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x3BE8, 0x11A2, 0x22C5, 0x4428, 0x5BA8, 0xFB8F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x3BE8, 0x11C2, 0x43E8, 0x6DCD, 0xA145, 0xF20A, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x3BE8, 0x0982, 0x6DAD, 0x75CE, 0x71A4, 0xF1C9, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x550B, 0x0982, 0x760E, 0x7E0E, 0x752C, 0xE9A9, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x550B, 0x0962, 0x762E, 0x862F, 0x76F1, 0xEAAB, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x550B, 0x0962, 0x762E, 0x7DEE, 0x43A8, 0x83C9, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x764E, 0x0921, 0x7E6F, 0x4C69, 0x4C4A, 0x6388, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x766E, 0x0921, 0x7E4F, 0x5D2B, 0x1142, 0x4C69, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x766E, 0x2265, 0x7E4E, 0x3C88, 0x33C6, 0x54CA, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x766E, 0x2265, 0x5D6C, 0x6DCB, 0x5D8B, 0x75CD, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x766E, 0x5C8B, 0x5D6C, 0xC607, 0x65AC, 0x756D, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x6E2E, 0x5C8B, 0x6D29, 0xF6C6, 0x65EC, 0x3B07, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x6E2E, 0x650C, 0x6D49, 0xFF07, 0xA6D1, 0x1943, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x6E2E, 0x8630, 0x6D49, 0xF728, 0xDF32, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x65AC, 0x8650, 0xB544, 0xF728, 0xF76E, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x65EC, 0x8650, 0xCDC5, 0xF76A, 0xF76D, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x65EC, 0x7E2F, 0xBD85, 0xF78C, 0xFFAF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x65EC, 0x7E2F, 0xEE86, 0xF78E, 0xF770, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x65EC, 0x7E2F, 0xEEA6, 0xF791, 0xF7B2, 0x0000, 0x10A1, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x65EC, 0x75EE, 0xEEA6, 0xF790, 0xFF8F, 0x0000, 0x21A4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x65CC, 0x75EE, 0xE687, 0xF790, 0xFF8D, 0x0020, 0x2A25, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x65CC, 0x75CD, 0xE687, 0xF78F, 0xFF6A, 0x0000, 0x0020, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x65CC, 0x75CD, 0xF6E7, 0xF78D, 0xF729, 0x0060, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x65CC, 0x75CD, 0xBE6A, 0xF78D, 0xCDE7, 0x0881, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x65CC, 0x6DAD, 0xCE89, 0xF78E, 0x9448, 0x65CC, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D8B, 0x6DAD, 0xA5E9, 0xF78E, 0xCE0A, 0x6DCC, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D6B, 0x6D8D, 0x54A9, 0xFF8B, 0xA4CA, 0x6DCD, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D6B, 0x6D8D, 0x54A9, 0xEEEA, 0x6C0A, 0x65AC, 0x0860, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D6B, 0x6D8D, 0x3BC7, 0x8CC6, 0x33A6, 0x5D8B, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D6B, 0x6D8D, 0x3BE8, 0x4386, 0x4488, 0x65AB, 0x0000, 0x0020, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D6B, 0x3366, 0x3BE8, 0x4CC9, 0x4CC9, 0x4CE9, 0x0881, 0x0881, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D6B, 0x3366, 0x548A, 0x3BA7, 0x4CA9, 0x3C47, 0x0881, 0x3245, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D6B, 0x4408, 0x5D2C, 0x22A4, 0x6DCD, 0x54C9, 0x1122, 0x5C4A, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D6B, 0x4408, 0x6DAD, 0x3346, 0x6DCC, 0x554A, 0x08E1, 0x6D8C, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D4B, 0x3BA7, 0x6D6D, 0x11C2, 0x65AC, 0x552A, 0x2AC5, 0x6D8C, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D4B, 0x3BA7, 0x6D6D, 0x11E3, 0x65AC, 0x4488, 0x6DEC, 0x6DCC, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D4B, 0x656C, 0x652C, 0x09A2, 0x75ED, 0x33A6, 0x5D4A, 0x5D6B, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D6B, 0x656C, 0x54CA, 0x09A2, 0x7E0E, 0x3386, 0x4407, 0x552A, 0x95F0, 0x0000, 0x0000, 0x0000, 0x0000, 0x49C1, 0x0000 }, 
  { 0x5D6B, 0x658C, 0x4428, 0x0982, 0x656C, 0x33A6, 0x4C28, 0x760D, 0x9ED2, 0x0000, 0x0000, 0x18C1, 0x1060, 0xF649, 0x0000 }, 
  { 0x5D6B, 0x552B, 0x3C08, 0x11A2, 0x5D2B, 0x1A64, 0x7E6E, 0x65CC, 0x7E6E, 0x5BEA, 0x0000, 0xF72C, 0xE5A7, 0xF747, 0x0000 }, 
  { 0x5D6B, 0x4CEA, 0x3C08, 0x11A2, 0x5D0A, 0x11E3, 0x6DCC, 0x6DCC, 0x764D, 0x866F, 0x2A05, 0xF76C, 0xFF8E, 0xF7A3, 0x0000 }, 
  { 0x4C89, 0x4CEA, 0x3BE7, 0x11A2, 0x2B05, 0x11C3, 0x5D4B, 0x760D, 0x6DEC, 0x6DEC, 0x4C09, 0xF5E4, 0xF74E, 0xF700, 0xB547 }, 
  { 0x4C89, 0x4CCA, 0x3BC7, 0x1182, 0x4C49, 0x1A23, 0x54C9, 0x656B, 0x5D6B, 0x550A, 0x32E5, 0xF625, 0xF645, 0xFF6B, 0xFFC7 }, 
  { 0x4C89, 0x4CC9, 0x33C7, 0x0982, 0x54AA, 0x2264, 0x2B05, 0x54C9, 0x4CC9, 0x3BC7, 0x2244, 0xF605, 0xFFCE, 0xFF26, 0xF6A4 }, 
  { 0x4408, 0x4CC9, 0x33A7, 0x0942, 0x2224, 0x2284, 0x0020, 0x43C7, 0x4428, 0x2AA5, 0x2205, 0xF6C7, 0xF725, 0xFFC2, 0x0020 }, 
  { 0x4408, 0x4CC9, 0x33A7, 0x0942, 0x08C1, 0x2B05, 0x0942, 0x54EA, 0x3387, 0x19E4, 0x10C2, 0xF72A, 0xF647, 0xFFC3, 0x0000 }, 
  { 0x4408, 0x54EA, 0x33A7, 0x0942, 0x32E5, 0x3387, 0x4408, 0x3346, 0x2AA5, 0x10E2, 0x0000, 0xA4C2, 0x7B62, 0xF687, 0x0000 }, 
  { 0x4408, 0x4CA9, 0x33A7, 0x0962, 0x4C89, 0x3387, 0x4449, 0x2A85, 0x1A04, 0x0000, 0x0000, 0x0000, 0x0000, 0xBD04, 0x0000 }, 
  { 0x19E3, 0x4CA9, 0x3386, 0x0941, 0x4408, 0x3366, 0x19E3, 0x32E6, 0x1102, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x19E3, 0x4C69, 0x3366, 0x0921, 0x4408, 0x33A7, 0x0080, 0x2AC6, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x19E3, 0x4C69, 0x3366, 0x00E1, 0x3BA7, 0x3366, 0x0080, 0x2AA5, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x0962, 0x19C3, 0x3387, 0x00A0, 0x3BC7, 0x3367, 0x00C1, 0x2A86, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x0901, 0x19C3, 0x3367, 0x08E1, 0x2284, 0x3BA7, 0x0060, 0x2224, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x0901, 0x3306, 0x2B26, 0x1162, 0x2284, 0x3BA8, 0x0060, 0x1102, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x0901, 0x3306, 0x2B06, 0x2AC5, 0x548A, 0x3346, 0x10E2, 0x0040, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x0901, 0x54EA, 0x2B06, 0x1A44, 0x4C8A, 0x3387, 0x11A4, 0x0861, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x00C1, 0x54EA, 0x0942, 0x1A44, 0x5D0B, 0x2B66, 0x9125, 0x0020, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x00C1, 0x550A, 0x08E1, 0x1A64, 0x54EB, 0x22E5, 0xE948, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x00C1, 0x550A, 0x08E1, 0x1A64, 0x5D2B, 0x5143, 0xF2EE, 0x70E4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x0101, 0x550A, 0x00A0, 0x2284, 0x3BA7, 0x5244, 0xFEBB, 0xC167, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x0100, 0x550A, 0x1A04, 0x22A4, 0x22C5, 0xB8C5, 0xFE9A, 0xF968, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x0100, 0x5D2B, 0x1162, 0x22A5, 0x0942, 0xA083, 0xF452, 0xF1A9, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x0100, 0x5D2B, 0x1A24, 0x22A5, 0x1182, 0xC0A5, 0xF34E, 0xF2ED, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x0100, 0x5D2B, 0x3BA8, 0x2B46, 0x19E3, 0xC0A5, 0xF24B, 0xF34F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x0100, 0x3BA8, 0x3BA8, 0x1A03, 0x19E4, 0x9925, 0xF1A9, 0xFB6F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x1163, 0x3BA8, 0x4409, 0x1A03, 0x1A04, 0x5904, 0xF189, 0x30A3, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x1163, 0x32A5, 0x4409, 0x19E3, 0x2244, 0x0000, 0xCA09, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x1163, 0x32A5, 0x4C8A, 0x00C1, 0x1A04, 0x0000, 0x32E7, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x1163, 0x32A5, 0x43E9, 0x0921, 0x1A04, 0x0000, 0x3B68, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x1163, 0x8C2A, 0x4CAA, 0x00A0, 0x2A66, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x32AB, 0x8C2A, 0x54CA, 0x00A1, 0x2AA6, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5455, 0x9511, 0x4C29, 0x00C1, 0x32C7, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5455, 0x4B2B, 0x4C29, 0x0060, 0x32E7, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5455, 0x5C95, 0x4408, 0x0080, 0x2B26, 0x0040, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D3A, 0x5C95, 0x3326, 0x0080, 0x2B26, 0x0061, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D3A, 0x4CFA, 0x3326, 0x00A0, 0x3B68, 0x1983, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D3A, 0x4CFA, 0x1A04, 0x00C0, 0x2B47, 0x3328, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x5D3A, 0x4D5C, 0x0962, 0x00A0, 0x3BA8, 0x3307, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x6DDD, 0x4D5C, 0x0101, 0x0942, 0x3BA8, 0x2224, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x75FC, 0x455C, 0x0942, 0x0982, 0x2285, 0x19E4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x75FC, 0x455C, 0x0942, 0x1182, 0x1183, 0x08A1, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0x75FC, 0x4D7C, 0x1182, 0x11E3, 0x11A3, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xA6BD, 0x4D7C, 0x1A03, 0x1A03, 0x19C3, 0x0040, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xA6BD, 0x559D, 0x2AA7, 0x1A44, 0x19C3, 0x08C2, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xA6BD, 0x5DBD, 0x3B4A, 0x2264, 0x2224, 0x2265, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xA6BD, 0x6E1D, 0x3B4A, 0x2285, 0x2245, 0x3307, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xAEDE, 0x6E1D, 0x5452, 0x2285, 0x19C4, 0x2B06, 0x19A3, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xAEDE, 0x761D, 0x5C94, 0x2285, 0x19C4, 0x19C4, 0x2AE6, 0x10E2, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
  { 0xAEDE, 0x763D, 0x64F6, 0x2265, 0x11C3, 0x438A, 0x1A24, 0x32A7, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }, 
};

Adafruit_NeoPixel strip = Adafruit_NeoPixel(NUM_LEDS, PIN, NEO_GRB + NEO_KHZ800);

boolean motor_state = false;

volatile uint32_t timer;
volatile uint32_t period, new_period, period_f;
volatile boolean timer_isr, hall_isr, new_loop;

uint16_t counter1, counter2;
uint8_t counter;
const byte n_segm = 360 / RES;
const byte offset = 0;
byte this_frame = 0, count_frame;

static uint32_t expandColor(uint16_t color) {
  return ((uint32_t)pgm_read_byte(&gamma5[color >> 11]) << 16) | ((uint32_t)pgm_read_byte(&gamma6[(color >> 5) & 0x3F]) << 8) | pgm_read_byte(&gamma5[color & 0x1F]);
}

void setup() {
  Serial.begin(115200);
  strip.begin();
  strip.setBrightness(BRIGHTNESS);
  attachInterrupt(0, hall, RISING);
  Timer1.initialize();
  Timer1.stop();
  Timer1.attachInterrupt(timer_interrupt);
  strip.clear();
  strip.show();
}

void hall() {
  if (micros() - timer > 30000) {
    new_period = micros() - timer;
    timer = micros();
    hall_isr = true;
  }
}

void timer_interrupt() {
  timer_isr = true;
}

void setPix(byte i, int counter, int this_pix) {
  switch (this_frame) {
    case 0:
      strip.setPixelColor(i, expandColor(pgm_read_word(&(frame0[counter][this_pix]))));
      break;
      // case 1: strip.setPixelColor(i, expandColor(pgm_read_word(&(frame1[counter][this_pix]))));
      //   break;
      // case 2: strip.setPixelColor(i, expandColor(pgm_read_word(&(frame2[counter][this_pix]))));
      //   break;
      // case 3: strip.setPixelColor(i, expandColor(pgm_read_word(&(frame3[counter][this_pix]))));
      //   break;
      // case 4: strip.setPixelColor(i, expandColor(pgm_read_word(&(frame4[counter][this_pix]))));
      //   break;
      // case 5: strip.setPixelColor(i, expandColor(pgm_read_word(&(frame5[counter][this_pix]))));
      //   break;
      // case 6: strip.setPixelColor(i, expandColor(pgm_read_word(&(frame6[counter][this_pix]))));
      //   break;
      // case 7: strip.setPixelColor(i, expandColor(pgm_read_word(&(frame7[counter][this_pix]))));
      //   break;
      // case 8: strip.setPixelColor(i, expandColor(pgm_read_word(&(frame8[counter][this_pix]))));
      //   break;
  }
}

void animation() {
  timer_isr = false;
  strip.clear();

  byte this_pix = 0;
  for (int i = NUM_LEDS / 2 - 1; i >= 0; i--) {
    setPix(i, counter1, this_pix);
    this_pix++;
  }
  this_pix = 0;
  for (int i = NUM_LEDS / 2; i < NUM_LEDS; i++) {
    setPix(i, counter2, this_pix);
    this_pix++;
  }

  counter1++;
  counter2++;
  if (counter2 > n_segm) counter2 = 0;
  if (counter1 > n_segm) counter1 = 0;

  strip.show();
}

void loop() {
  if (hall_isr) {
    hall_isr = false;
    counter1 = 0 + offset;
    counter2 = n_segm / 2 + offset;
    if (counter2 > n_segm) counter2 = counter2 - n_segm;

    count_frame++;
    if (count_frame >= FRAME_RATE) {
      count_frame = 0;
      this_frame = ++this_frame % NUM_FRAMES;
    }

    animation();
    period_f = (float)new_period * COEF + (float)period_f * ((float)1 - COEF);
    Timer1.setPeriod(period_f / n_segm * PODGON);
    Timer1.restart();
  }

  if (timer_isr) {
    timer_isr = false;
    animation();
  }
}